<!DOCTYPE html>
<html>
    <head>
        <title>Godfrin - Mawet - Duditlieux</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- On charge jQuery -->
        <script	src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <!-- On charge le moteur de template mustache https://mustache.github.io/ -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"></script>
        <script>
            $(document).ready(// Exécuté à la fin du chargement de la page
                    function () {
                        // On montre la liste des codes
                        
                    }
            );
            function showCodes() {
                // On fait un appel AJAX pour chercher les codes
                $.ajax({
                    url: "DiscountCodeInServlet",
                    dataType: "json",
                    error: showError,
                    success: // La fonction qui traite les résultats
                            function (result) {
                                // Le code source du template est dans la page
                                var template = $('#codesTemplate').html();
                                // On combine le template avec le résultat de la requête
                                var processedTemplate = Mustache.to_html(template, result);
                                // On affiche la liste des options dans le select
                                $('#codes').html(processedTemplate);
                            }
                });
            }
            // Ajouter un code
            function addCode() {
                $.ajax({
                    url: "addCode",
                    // serialize() renvoie tous les paramètres saisis dans le formulaire
                    data: $("#codeForm").serialize(),
                    dataType: "json",
                    success: // La fonction qui traite les résultats
                            function (result) {
                                showCodes();
                                console.log(result);
                            },
                    error: showError
                });
                return false;
            }
            // Supprimer un code
            function deleteCode(code) {
                $.ajax({
                    url: "deleteCode",
                    data: {"code": code},
                    dataType: "json",
                    success: 
                            function (result) {
                                showCodes();
                                console.log(result);
                            },
                    error: showError
                });
                return false;
            }
            // Fonction qui traite les erreurs de la requête
            function showError(xhr, status, message) {
                alert(JSON.parse(xhr.responseText).message);
            }
        </script>
        <style>
            h1 {
                
                font-family: sans-serif;
                margin: 20px;
                text-decoration: underline;
                font-size: 40px;
                color: black;
            }
            
            #codeForm{
                text-align: right;
                
            }
            
            body {
                background: cyan;
            }
        </style>
        <link rel="stylesheet" type="text/css" href="css/tableformat.css">
    </head>
    <body>
        
        <!-- On montre le formulaire de saisie -->
        <h1>Site de ses morts</h1>
        <form id="codeForm" onsubmit="event.preventDefault(); Connect();">
           
            Pseudo : <input id="pseudo" name="code" required size="10" pattern="[A-Z]{1,1}" title="Une lettre en MAJUSCULES"><br/>
            Mot de passe : <input id ="mdp" name="mdp" required size="10">
            <input type="submit" value="Se connecter">
            
        </form>
         <!-- La zone où les résultats vont s'afficher -->
        <div id="codes"></div>

        <!-- Le template qui sert à formatter la liste des codes -->
        
    </body>
</html>